{
  "openapi": "3.0.3",
  "info": {
    "title": "Minha API",
    "description": "Exemplo de API REST",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:3000/api",
      "description": "Servidor local"
    }
  ],
"paths": {
    "/pedidos": {
      "post": {
        "tags": ["Pedidos"],
        "summary": "Registrar um novo pedido",
        "description": "Cria um novo pedido. Suporta envio de campos e arquivo PDF via form-data.",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "codigo_multas": { "type": "string" },
                  "codigo_regime": { "type": "string" },
                  "consignatario_importador": { "type": "string" },
                  "codigo_avaliacao_autorizado": { "type": "string" },
                  "nome_entidade_angola": { "type": "string" },
                  "manifesto_numero": { "type": "string" },
                  "numero_total_adicoes": { "type": "integer" },
                  "despachante": { "type": "string" },
                  "entidade_estrangeira": { "type": "string" },
                  "descricao_mercadoria": { "type": "string" },
                  "pais_origem": { "type": "string" },
                  "pais_destino": { "type": "string" },
                  "porto_entrada": { "type": "string" },
                  "data_chegada": { "type": "string", "format": "date-time" },
                  "numero_fatura_proforma": { "type": "string" },
                  "transporte": { "type": "string", "description": "JSON string com transporte" },
                  "mercadorias": { "type": "string", "description": "JSON string com array de mercadorias" },
                  "pagamento": { "type": "string", "description": "JSON string com pagamento" },
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "Arquivo PDF do documento"
                  }
                },
                "required": [
                  "codigo_multas",
                  "codigo_regime",
                  "consignatario_importador",
                  "transporte",
                  "mercadorias",
                  "pagamento",
                  "documento"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Pedido registrado com sucesso",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Pedido" }
              }
            }
          },
          "400": {
            "description": "Dados inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string", "example": "Campo obrigatório faltando" }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": { "type": "string", "example": "Erro ao registrar pedido" }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/pedidos/read_file": {
      "post": {
        "tags": ["File"],
        "summary": "Enviar ficheiro TXT via formData e converter para JSON",
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "Ficheiro TXT a ser convertido"
                  }
                },
                "required": ["file"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Ficheiro convertido com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean" },
                    "data": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Nenhum ficheiro enviado"
          },
          "500": {
            "description": "Erro ao processar ficheiro"
          }
        }
      }
    }
  
  },
  "components": {
    "schemas": {
      "Transporte": {
        "type": "object",
        "properties": {
          "meio_transporte": { "type": "string" },
          "nacionalidade_meio_transporte": { "type": "string" },
          "registro_meio_transporte": { "type": "string" },
          "num_documento_transporte": { "type": "string" },
          "estancia_aduaneira": { "type": "string" },
          "porto_origem": { "type": "string" },
          "posto_fronteirico": { "type": "string" },
          "peso_bruto": { "type": "number" },
          "local_embarque": { "type": "string" },
          "local_desalfandegamento": { "type": "string" },
          "pais_precedencia": { "type": "string" },
          "referencia_processo_interno": { "type": "string" }
        },
        "required": ["meio_transporte", "registro_meio_transporte", "peso_bruto"]
      },
      "Mercadoria": {
        "type": "object",
        "properties": {
          "linha": { "type": "integer" },
          "codigo_pautal": { "type": "string" },
          "quantidade": { "type": "number" },
          "pais_origem_2": { "type": "string" },
          "peso": { "type": "number" },
          "moeda_estrangeira": { "type": "string" },
          "valor_fob": { "type": "number" },
          "valor_frete": { "type": "number" },
          "valor_cif": { "type": "number" },
          "unidade_medida": { "type": "string" }
        },
        "required": ["linha", "codigo_pautal", "quantidade", "peso"]
      },
      "Pagamento": {
        "type": "object",
        "properties": {
          "metodo_avaliacao": { "type": "string" },
          "banco_comercial": { "type": "string" },
          "forma_pagamento": { "type": "string" },
          "qtd_volume": { "type": "integer" },
          "codigo_volume": { "type": "string" },
          "unidade": { "type": "string" }
        },
        "required": ["metodo_avaliacao", "forma_pagamento"]
      },
      "Documento": {
        "type": "object",
        "properties": {
          "tipo_documento": { "type": "string" },
          "caminho_arquivo": { "type": "string" },
          "codigo_pre_licenciamento": { "type": "string" }
        },
        "required": ["tipo_documento", "caminho_arquivo"]
      },
      "Pedido": {
        "type": "object",
        "properties": {
          "codigo_multas": { "type": "string" },
          "codigo_regime": { "type": "string" },
          "consignatario_importador": { "type": "string" },
          "codigo_avaliacao_autorizado": { "type": "string" },
          "nome_entidade_angola": { "type": "string" },
          "manifesto_numero": { "type": "string" },
          "numero_total_adicoes": { "type": "integer" },
          "despachante": { "type": "string" },
          "entidade_estrangeira": { "type": "string" },
          "descricao_mercadoria": { "type": "string" },
          "pais_origem": { "type": "string" },
          "pais_destino": { "type": "string" },
          "porto_entrada": { "type": "string" },
          "data_chegada": { "type": "string", "format": "date-time" },
          "numero_fatura_proforma": { "type": "string" },
          "transporte": { "$ref": "#/components/schemas/Transporte" },
          "mercadorias": {
            "type": "array",
            "items": { "$ref": "#/components/schemas/Mercadoria" }
          },
          "pagamento": { "$ref": "#/components/schemas/Pagamento" },
          "documento": { "$ref": "#/components/schemas/Documento" }
        },
        "required": [
          "codigo_multas",
          "codigo_regime",
          "consignatario_importador",
          "transporte",
          "mercadorias",
          "pagamento",
          "documento"
        ]
      }
    }
  }
}
